# æ˜¯å¦å…è®¸å±€åŸŸç½‘
allow-lan: false
# ç»‘å®šåœ°å€
bind-address: 0.0.0.0
# æ··åˆç«¯å£
mixed-port: 7890

# è¿è¡Œæ¨¡å¼
mode: rule
# æ—¥å¿—çº§åˆ«
log-level: warning

# ipv6
ipv6: true

# è¿›ç¨‹åŒ¹é…æ¨¡å¼
find-process-mode: strict

# å¤–éƒ¨æ§åˆ¶ (API)
external-controller: 127.0.0.1:9090
# API è®¿é—®å¯†é’¥
secret: "mihomo123456"
# å¤–éƒ¨ç”¨æˆ·ç•Œé¢
external-ui: zashboard
# å¤–éƒ¨ç”¨æˆ·ç•Œé¢ä¸‹è½½åœ°å€
external-ui-url: https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip

profile:
  # å‚¨å­˜ API å¯¹ç­–ç•¥ç»„çš„é€‰æ‹©ï¼Œä»¥ä¾›ä¸‹æ¬¡å¯åŠ¨æ—¶ä½¿ç”¨
  store-selected: true

# ç»Ÿä¸€å»¶è¿Ÿ
unified-delay: true
# tcp å¹¶å‘
tcp-concurrent: true

# å…¨å±€å®¢æˆ·ç«¯æŒ‡çº¹
global-client-fingerprint: chrome

# GEOIP æ•°æ®æ¨¡å¼
geodata-mode: true
# è‡ªåŠ¨æ›´æ–° GEO
geo-auto-update: true
geo-update-interval: 24
# è‡ªå®šä¹‰ GEO ä¸‹è½½åœ°å€
geox-url:
  geoip: https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat
  geosite: https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat
  mmdb: https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country-lite.mmdb
  asn: https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/GeoLite2-ASN.mmdb

localdns: &localdns 127.0.0.1
dns:
  # å¯ç”¨dnsæ¨¡å—
  enable: true
  # å¯ç”¨ipv6 dnsè§£æ
  ipv6: true
  enhanced-mode: redir-host
  cache-algorithm: arc
  respect-rules: true
  default-nameserver:
    - *localdns
  proxy-server-nameserver:
    - *localdns
  nameserver:
    - *localdns
  nameserver-policy:
    "geosite:!cn":
      - https://1.1.1.1/dns-query
      - https://8.8.8.8/dns-query

proxytest: &proxytest
  url: https://cp.cloudflare.com
  interval: 0
  timeout: 2000
  max-failed-times: 5
  expected-status: 204

# ä»£ç†é›†åˆ
proxy-providers:
  daili:
    type: http
    url: {{ .daili_proxy_url }}
    path: proxy-providers/daili.yaml
    interval: 43200
    proxy: DIRECT
    exclude-type: hysteria2
    override:
      udp-over-tcp: true
      udp-over-tcp-version: 2

  wuxian1:
    type: http
    url: {{ .wuxian1_proxy_url }}
    path: proxy-providers/wuxian1.yaml
    interval: 43200
    proxy: DIRECT
    exclude-type: hysteria2
    override:
      additional-suffix: -w1

  wuxian2:
    type: http
    url: {{ .wuxian2_proxy_url }}
    path: proxy-providers/wuxian2.yaml
    interval: 43200
    proxy: DIRECT
    exclude-type: hysteria2
    override:
      additional-suffix: -w2

proxies:
  - name: warp
    type: wireguard
    dialer-proxy: dailiproxy
    private-key: {{ .warp_private_key }}
    public-key: {{ .warp_public_key }}
    ip: 172.16.0.2/32
    ipv6: 2606:4700:110:8c9e:210a:1e69:57ff:bed/128
    server: engage.cloudflareclient.com
    port: 2408
    allowed-ips: ['0.0.0.0/0', '::/0']
    reserved: CxiT
    udp: true
    mtu: 1420

  - name: xiaoji-vl
    type: vless
    server: {{ .xiaoji_server_ip }}
    port: 7878
    udp: true
    uuid: {{ .xiaoji_uuid }}
    flow: xtls-rprx-vision
    packet-encoding: xudp
    tls: true
    servername: aws.amazon.com
    reality-opts:
      public-key: {{ .xiaoji_public_key }}
      short-id: {{ .xiaoji_short_id }}

  - name: xiaoji-vlcdn
    type: vless
    dialer-proxy: wuxianproxy
    server: {{ .xiaoji_server }}
    port: 443
    udp: true
    uuid: {{ .xiaoji_uuid_2 }}
    packet-encoding: xudp
    tls: true
    network: ws
    servername: {{ .xiaoji_server }}
    smux:
      enabled: true
      max-connections: 4
      min-streams: 2

  - name: xiaoji-ss
    type: ss
    dialer-proxy: wuxianproxy
    server: {{ .xiaoji_server_ip }}
    port: 7879
    cipher: 2022-blake3-chacha20-poly1305
    password: {{ .xiaoji_jp_password }}
    udp: true
    udp-over-tcp: true
    udp-over-tcp-version: 2
    smux:
      enabled: true
      max-connections: 4
      min-streams: 2

# ä»£ç†ç»„
proxy-groups:
  - name: warproxy
    type: select
    proxies:
      - warp
      - dailiproxy
      - protonproxy

  - name: protonproxy
    type: select
    proxies:
      - xiaoji-vlcdn
      - xiaoji-ss
      - wuxianproxy

  - name: dailiproxy
    type: select
    proxies:
      - ç¾å›½-daili
      - æ—¥æœ¬-daili
      - æ–°åŠ å¡-daili
      - é¦™æ¸¯-daili
      - å°æ¹¾-daili
      - å…¶å®ƒåœ°åŒº-daili
      - å…¨éƒ¨èŠ‚ç‚¹-daili
      - DIRECT
      - xiaoji-vl

  - name: wuxianproxy
    type: select
    proxies:
      - ç¾å›½-wuxian
      - æ—¥æœ¬-wuxian
      - æ–°åŠ å¡-wuxian
      - é¦™æ¸¯-wuxian
      - å°æ¹¾-wuxian
      - å…¶å®ƒåœ°åŒº-wuxian
      - å…¨éƒ¨èŠ‚ç‚¹-wuxian
      - dailiproxy
      - xiaoji-vl

  - name: ç¾å›½-daili
    type: select
    filter: "(?i)ç¾å›½|us|unitedstates|united states"
    <<: *proxytest
    use:
      - daili

  - name: ç¾å›½-wuxian
    type: load-balance
    strategy: round-robin
    filter: "(?i)ç¾å›½|us|unitedstates|united states"
    <<: *proxytest
    use:
      - wuxian1
      - wuxian2

  - name: æ—¥æœ¬-daili
    type: select
    filter: "(?i)æ—¥æœ¬|jp|japan"
    <<: *proxytest
    use:
     - daili

  - name: æ—¥æœ¬-wuxian
    type: select
    filter: "(?i)æ—¥æœ¬|jp|japan"
    <<: *proxytest
    use:
     - wuxian1
     - wuxian2

  - name: æ–°åŠ å¡-daili
    type: select
    filter: "(?i)(æ–°åŠ å¡|sg|singapore)"
    <<: *proxytest
    use:
      - daili

  - name: æ–°åŠ å¡-wuxian
    type: load-balance
    strategy: round-robin
    filter: "(?i)(æ–°åŠ å¡|sg|singapore)"
    <<: *proxytest
    use:
      - wuxian1
      - wuxian2

  - name: é¦™æ¸¯-daili
    type: select
    filter: "(?i)é¦™æ¸¯|hk|hongkong|hong kong"
    <<: *proxytest
    use:
      - daili

  - name: é¦™æ¸¯-wuxian
    type: select
    filter: "(?i)é¦™æ¸¯|hk|hongkong|hong kong"
    <<: *proxytest
    use:
      - wuxian1
      - wuxian2

  - name: å°æ¹¾-daili
    type: select
    filter: "(?i)å°æ¹¾|tw|taiwan"
    <<: *proxytest
    use:
      - daili

  - name: å°æ¹¾-wuxian
    type: select
    filter: "(?i)å°æ¹¾|tw|taiwan"
    <<: *proxytest
    use:
      - wuxian1
      - wuxian2

  - name: å…¶å®ƒåœ°åŒº-daili
    type: select
    filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|é¦™æ¸¯|hk|hongkong|å°æ¹¾|tw|taiwan|æ—¥æœ¬|jp|japan|æ–°åŠ å¡|sg|singapore|ç¾å›½|us|unitedstates)).*"
    <<: *proxytest
    use:
      - daili

  - name: å…¶å®ƒåœ°åŒº-wuxian
    type: select
    filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|é¦™æ¸¯|hk|hongkong|å°æ¹¾|tw|taiwan|æ—¥æœ¬|jp|japan|æ–°åŠ å¡|sg|singapore|ç¾å›½|us|unitedstates)).*"
    <<: *proxytest
    use:
      - wuxian1
      - wuxian2

  - name: å…¨éƒ¨èŠ‚ç‚¹-daili
    type: select

    use:
     - daili

  - name: å…¨éƒ¨èŠ‚ç‚¹-wuxian
    type: select
    use:
     - wuxian1
     - wuxian2

ruleset_domain: &ruleset_domain {type: http, interval: 43200, behavior: domain, format: text, proxy: dailiproxy}
ruleset_ipcidr: &ruleset_ipcidr {type: http, interval: 43200, behavior: ipcidr, format: text, proxy: dailiproxy}
ruleset_classical: &ruleset_classical {type: http, interval: 43200, behavior: classical, format: text, proxy: dailiproxy}

# è§„åˆ™è§£é‡Šhttps://blog.skk.moe/post/i-have-my-unique-surge-setup/
rule-providers:
  # === domainsetè§„åˆ™ ===
  # appleä¸­å›½cdnåŸŸ
  apple-cdn-domainset:
    <<: *ruleset_domain
    path: rules/apple-cdn-domainset.txt
    url: "https://ruleset.skk.moe/Clash/domainset/apple_cdn.txt"

  # å¯¹è±¡å­˜å‚¨å’Œé™æ€èµ„äº§cdnåŸŸ
  cdn-domainset:
    <<: *ruleset_domain
    path: rules/cdn-domainset.txt
    url: "https://ruleset.skk.moe/Clash/domainset/cdn.txt"

  # è½¯ä»¶æ›´æ–°ã€æ“ä½œç³»ç»Ÿç­‰å¤§æ–‡ä»¶ä¸‹è½½çš„åŸŸ
  download-domainset:
    <<: *ruleset_domain
    path: rules/download-domainset.txt
    url: https://ruleset.skk.moe/Clash/domainset/download.txt

  # Gameä¸‹è½½ï¼Œä»¥åŠSteamã€Epicã€Blizzardã€Gogã€Ubisoftã€EAã€Xboxã€PlayStationã€Riotã€Bethesdaç­‰çš„CDNåŸŸ
  game-download-domainset:
    <<: *ruleset_domain
    path: rules/game-download-domainset.txt
    url: "https://ruleset.skk.moe/Clash/domainset/game-download.txt"

  # speedteståŸŸ
  speedtest-domainset:
    <<: *ruleset_domain
    path: rules/speedtest-domainset.txt
    url: "https://ruleset.skk.moe/Clash/domainset/speedtest.txt"

  # === non_ipè§„åˆ™ ===
  # åŒ…å« OpenAIã€Google Geminiã€Claudeã€Perplexity ç­‰çš„åŸŸ
  ai-non_ip:
    <<: *ruleset_classical
    path: rules/ai-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/ai.txt"

  # appleä¸­å›½cdnåŸŸ
  apple-cdn-non_ip:
    <<: *ruleset_classical
    path: rules/apple-cdn-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/apple_cdn.txt"

  # appleä¸­å›½æœåŠ¡åŸŸ
  apple-cn-non_ip:
    <<: *ruleset_classical
    path: rules/apple-cn-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/apple_cn.txt"

  # appleåŸŸ
  apple-services-non_ip:
    <<: *ruleset_classical
    path: rules/apple-services-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/apple_services.txt"

  # å¯¹è±¡å­˜å‚¨å’Œé™æ€èµ„äº§cdnåŸŸ
  cdn-non_ip:
    <<: *ruleset_classical
    path: rules/cdn-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/cdn.txt"

  # è½¯ä»¶æ›´æ–°ã€æ“ä½œç³»ç»Ÿç­‰å¤§æ–‡ä»¶ä¸‹è½½çš„åŸŸ
  download-non_ip:
   <<: *ruleset_classical
   path: rules/download-non_ip.txt
   url: https://ruleset.skk.moe/Clash/non_ip/download.txt

  # ä¸åº”ä»£ç†çš„åŸŸå’Œè¿›ç¨‹
  direct-non_ip:
    <<: *ruleset_classical
    path: rules/direct-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/direct.txt"

  # ä¸­å›½å¤§é™†åœ°åŒºåŸŸ
  domestic-non_ip:
    <<: *ruleset_classical
    path: rules/domestic-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/domestic.txt"

  # ä¸­å›½å¤§é™†åœ°åŒºä¸å¯ç”¨æœåŠ¡åŸŸ
  global-non_ip:
    <<: *ruleset_classical
    path: rules/global-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/global.txt"

  # LAN åŸŸå’Œä¿ç•™TLD
  lan-non_ip:
    <<: *ruleset_classical
    path: rules/lan-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/lan.txt"

  # å¾®è½¯åŸŸ
  microsoft-non_ip:
    <<: *ruleset_classical
    path: rules/microsoft-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/microsoft.txt"

  # å¾®è½¯ä¸­å›½cdnåŸŸ
  microsoft-cdn-non_ip:
    <<: *ruleset_classical
    path: rules/microsoft-cdn-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/microsoft_cdn.txt"

  # æµåª’ä½“åŸŸ
  stream-non_ip:
    <<: *ruleset_classical
    path: rules/stream-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/stream.txt"

  # bilibiliå›½é™…åŸŸ
  stream-biliintl-non_ip:
    <<: *ruleset_classical
    path: rules/stream-biliintl-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/stream_biliintl.txt"

  # telegramåŸŸ
  telegram-non_ip:
    <<: *ruleset_classical
    path: rules/telegram-non_ip.txt
    url: "https://ruleset.skk.moe/Clash/non_ip/telegram.txt"

  # === ipè§„åˆ™ ===
  # apple ip
  apple-services-ip:
    <<: *ruleset_classical
    path: rules/apple-services-ip.txt
    url: "https://ruleset.skk.moe/Clash/ip/apple_services.txt"

  # å¯¹è±¡å­˜å‚¨å’Œé™æ€èµ„äº§cdn ip
  cdn-ip:
    <<: *ruleset_classical
    path: rules/cdn-ip.txt
    url: "https://ruleset.skk.moe/Clash/ip/cdn.txt"

  china-ip:
    <<: *ruleset_ipcidr
    path: rules/china-ip.txt
    url: "https://ruleset.skk.moe/Clash/ip/china_ip.txt"

  china-ipv6:
    <<: *ruleset_ipcidr
    path: rules/china-ipv6.txt
    url: "https://ruleset.skk.moe/Clash/ip/china_ip_ipv6.txt"

  # ä¸­å›½å¤§é™†å¹¿æ’­ip
  domestic-ip:
    <<: *ruleset_classical
    path: rules/domestic-ip.txt
    url: "https://ruleset.skk.moe/Clash/ip/domestic.txt"

  lan-ip:
    <<: *ruleset_classical
    path: rules/lan-ip.txt
    url: "https://ruleset.skk.moe/Clash/ip/lan.txt"

  # æµåª’ä½“ip
  stream-ip:
    <<: *ruleset_classical
    path: rules/stream-ip.txt
    url: "https://ruleset.skk.moe/Clash/ip/stream.txt"

  # bilibiliå›½é™…ip
  stream-biliintl-ip:
    <<: *ruleset_classical
    path: rules/stream-biliintl-ip.txt
    url: "https://ruleset.skk.moe/Clash/ip/stream_biliintl.txt"

  telegram-ip:
    <<: *ruleset_classical
    path: rules/telegram-ip.txt
    url: "https://ruleset.skk.moe/Clash/ip/telegram.txt"

  telegram-asn-ip:
    <<: *ruleset_classical
    path: rules/telegram-asn-ip.txt
    url: "https://ruleset.skk.moe/Clash/ip/telegram_asn.txt"

rules:
  - DOMAIN,data.bilibili.com,REJECT
  - DOMAIN-SUFFIX,smnet.studio,protonproxy
  - DOMAIN-SUFFIX,server.alice.dns-dynamic.net,dailiproxy
  - DOMAIN-SUFFIX,githubusercontent.com,protonproxy
  - IP-CIDR,1.1.1.1/32,dailiproxy
  - IP-CIDR,8.8.8.8/32,dailiproxy
  # Youtube
  - DOMAIN-SUFFIX,googlevideo.com,protonproxy
  # Spotify
  - DOMAIN-SUFFIX,spotifycdn.com,protonproxy
  - DOMAIN-SUFFIX,scdn.co,protonproxy
  # Twitch
  - DOMAIN-SUFFIX,jtvnw.net,protonproxy
  - DOMAIN-SUFFIX,ttvnw.net,protonproxy
  - DOMAIN-SUFFIX,twitchcdn.net,protonproxy
  - DOMAIN-SUFFIX,twitchsvc.net,protonproxy

  # domainè§„åˆ™
  # å›½å†…
  - RULE-SET,apple-cdn-domainset,DIRECT
  - RULE-SET,apple-cdn-non_ip,DIRECT
  - RULE-SET,apple-cn-non_ip,DIRECT
  - RULE-SET,direct-non_ip,DIRECT
  - RULE-SET,domestic-non_ip,DIRECT
  - RULE-SET,lan-non_ip,DIRECT
  - RULE-SET,microsoft-cdn-non_ip,DIRECT
  # å›½å¤–
  - RULE-SET,cdn-domainset,protonproxy
  - RULE-SET,download-domainset,protonproxy
  - RULE-SET,game-download-domainset,protonproxy
  - RULE-SET,speedtest-domainset,warproxy
  - RULE-SET,ai-non_ip,warproxy
  - RULE-SET,apple-services-non_ip,warproxy
  - RULE-SET,cdn-non_ip,protonproxy
  - RULE-SET,download-non_ip,protonproxy
  - RULE-SET,global-non_ip,warproxy
  - RULE-SET,microsoft-non_ip,warproxy
  #- RULE-SET,stream-non_ip,warproxy
  - RULE-SET,telegram-non_ip,protonproxy

  # ipè§„åˆ™
  # å›½å†…
  - RULE-SET,china-ip,DIRECT
  - RULE-SET,china-ipv6,DIRECT
  - RULE-SET,domestic-ip,DIRECT
  - RULE-SET,lan-ip,DIRECT
  # å›½å¤–
  - RULE-SET,apple-services-ip,warproxy
  - RULE-SET,cdn-ip,protonproxy
  #- RULE-SET,stream-ip,warproxy
  - RULE-SET,telegram-ip,protonproxy
  - RULE-SET,telegram-asn-ip,protonproxy
  
  # GETè§„åˆ™
  - GEOSITE,private,DIRECT
  - GEOSITE,CN,DIRECT
  - GEOIP,private,DIRECT
  - GEOIP,CN,DIRECT

  - GEOSITE,geolocation-!cn,warproxy
  - MATCH,warproxy

